<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes App</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
}
#login, #app{display:none;}
.box{
  max-width:420px;
  margin:60px auto;
  padding:20px;
}
input,button{
  width:100%;
  padding:14px;
  border-radius:10px;
  border:none;
  margin-top:10px;
  font-size:16px;
}
button{background:#222;color:#fff}
.note{
  background:#111;
  padding:12px;
  border-radius:10px;
  margin-top:10px;
}
</style>
</head>
<body>

<div id="login" class="box">
  <h2>Email Login</h2>
  <input id="email" type="email" placeholder="Enter email">
  <button onclick="login()">Send Login Link</button>
  <p id="msg"></p>
</div>

<div id="app" class="box">
  <h2>Your Notes</h2>
  <input id="noteText" placeholder="Write note">
  <button onclick="addNote()">Save</button>
  <div id="notes"></div>
  <button onclick="logout()">Logout</button>
</div>

<!-- âœ… Supabase CDN (VERY IMPORTANT) -->
<script src="https://unpkg.com/@supabase/supabase-js@2"></script>

<script>
const supabaseUrl = "https://dzamnsktajdhzwgogibh.supabase.co";
const supabaseKey = "sb_publishable_9OlBc8vMTQHZxdgFukexDw__O08xdH_";
const supabase = window.supabase.createClient(supabaseUrl, supabaseKey);

const loginDiv = document.getElementById("login");
const appDiv = document.getElementById("app");

async function login(){
  const email = document.getElementById("email").value;
  if(!email) return;

  const { error } = await supabase.auth.signInWithOtp({
    email,
    options:{
      emailRedirectTo: "https://x-cyber-2025.github.io/notes-app/"
    }
  });

  document.getElementById("msg").innerText =
    error ? error.message : "Check your email inbox";
}

async function checkUser(){
  const { data:{ session } } = await supabase.auth.getSession();
  if(session){
    loginDiv.style.display="none";
    appDiv.style.display="block";
    loadNotes();
  }else{
    loginDiv.style.display="block";
  }
}

async function addNote(){
  const text = noteText.value;
  if(!text) return;

  const user = (await supabase.auth.getUser()).data.user;

  await supabase.from("notes").insert({
    user_id: user.id,
    body: text,
    created: Date.now()
  });

  noteText.value="";
  loadNotes();
}

async function loadNotes(){
  const user = (await supabase.auth.getUser()).data.user;

  const { data } = await supabase
    .from("notes")
    .select("*")
    .eq("user_id", user.id)
    .order("created",{ascending:false});

  notes.innerHTML="";
  data.forEach(n=>{
    notes.innerHTML += `<div class="note">${n.body}</div>`;
  });
}

async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

checkUser();
</script>
</body>
</html>