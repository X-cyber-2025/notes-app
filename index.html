<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Notes</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>

<style>
body{
  margin:0;
  font-family:system-ui;
  background:#000;
  color:#fff;
}
button,input,textarea{
  width:100%;
  padding:12px;
  margin:6px 0;
  border:none;
  border-radius:10px;
  font-size:15px;
}
button{background:#1f1f1f;color:#fff}
.card{background:#111;padding:14px;border-radius:12px;margin:10px 0}
.hidden{display:none}
</style>
</head>

<body>

<div id="auth">
  <h2>Email Login</h2>
  <input id="email" placeholder="Enter email">
  <button onclick="login()">Send Login Link</button>
</div>

<div id="app" class="hidden">
  <h2>My Notes</h2>
  <textarea id="noteText" placeholder="Write note..."></textarea>
  <button onclick="addNote()">Save Note</button>
  <div id="notes"></div>
  <button onclick="logout()">Logout</button>
</div>

<script>
const supabase = supabase.createClient(
  "https://dzamnsktajdhzwgogibh.supabase.co",
  "sb_publishable_9OlBc8vMTQHZxdgFukexDw__O08xdH_"
);

async function login(){
  const email = document.getElementById("email").value;
  if(!email) return alert("Enter email");
  await supabase.auth.signInWithOtp({
    email,
    options:{
      emailRedirectTo:"https://x-cyber-2025.github.io/notes-app/"
    }
  });
  alert("Check your email");
}

async function logout(){
  await supabase.auth.signOut();
  location.reload();
}

async function loadNotes(){
  const {data} = await supabase
    .from("notes")
    .select("*")
    .order("created",{ascending:false});

  const box=document.getElementById("notes");
  box.innerHTML="";
  data.forEach(n=>{
    const d=document.createElement("div");
    d.className="card";
    d.innerHTML=`
      <pre>${n.body}</pre>
      <button onclick="delNote('${n.id}')">Delete</button>
    `;
    box.appendChild(d);
  });
}

async function addNote(){
  const text=document.getElementById("noteText").value.trim();
  if(!text)return;
  const user=(await supabase.auth.getUser()).data.user;
  await supabase.from("notes").insert({
    body:text,
    user_id:user.id,
    created:Date.now()
  });
  noteText.value="";
  loadNotes();
}

async function delNote(id){
  await supabase.from("notes").delete().eq("id",id);
  loadNotes();
}

supabase.auth.onAuthStateChange((_,session)=>{
  if(session){
    auth.classList.add("hidden");
    app.classList.remove("hidden");
    loadNotes();
  }
});
</script>

</body>
</html>
